<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚ò¢Ô∏è Atomovka Backup Viewer</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
    :root {
        --green:    #00ff41;
        --green-dim:#00aa2a;
        --bg:       #050a05;
        --bg2:      #0a120a;
        --bg3:      #0f1f0f;
        --border:   #1a3a1a;
        --text:     #c8e6c9;
        --text-dim: #557a55;
        --warn:     #ffaa00;
        --error:    #ff4444;
        --blue:     #00d4ff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
        background: var(--bg);
        color: var(--text);
        font-family: 'Share Tech Mono', monospace;
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ GRID POZAD√ç ‚îÄ‚îÄ */
    body::before {
        content: '';
        position: fixed;
        inset: 0;
        background-image:
            linear-gradient(rgba(0,255,65,.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0,255,65,.03) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
        z-index: 0;
    }

    /* ‚îÄ‚îÄ SCANLINE ‚îÄ‚îÄ */
    body::after {
        content: '';
        position: fixed;
        inset: 0;
        background: repeating-linear-gradient(
            0deg,
            transparent,
            transparent 2px,
            rgba(0,0,0,.15) 2px,
            rgba(0,0,0,.15) 4px
        );
        pointer-events: none;
        z-index: 1;
    }

    .wrapper {
        position: relative;
        z-index: 2;
        max-width: 1100px;
        margin: 0 auto;
        padding: 32px 20px 60px;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
        text-align: center;
        margin-bottom: 40px;
    }

    .logo {
        font-family: 'Orbitron', sans-serif;
        font-size: clamp(22px, 5vw, 42px);
        font-weight: 900;
        color: var(--green);
        text-shadow:
            0 0 10px var(--green),
            0 0 30px rgba(0,255,65,.4);
        letter-spacing: 4px;
        animation: flicker 6s infinite;
    }

    @keyframes flicker {
        0%,95%,100% { opacity: 1; }
        96% { opacity: .7; }
        97% { opacity: 1; }
        98% { opacity: .5; }
    }

    .subtitle {
        color: var(--text-dim);
        font-size: 13px;
        letter-spacing: 3px;
        margin-top: 6px;
    }

    .divider {
        border: none;
        border-top: 1px solid var(--border);
        margin: 24px 0;
        position: relative;
    }
    .divider::after {
        content: '‚óÜ';
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
        background: var(--bg);
        color: var(--green-dim);
        padding: 0 12px;
        font-size: 10px;
    }

    /* ‚îÄ‚îÄ DROP ZONE ‚îÄ‚îÄ */
    .drop-zone {
        border: 2px dashed var(--green-dim);
        border-radius: 8px;
        padding: 48px 24px;
        text-align: center;
        cursor: pointer;
        transition: all .3s;
        background: var(--bg2);
        position: relative;
        overflow: hidden;
    }

    .drop-zone::before {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 50% 50%, rgba(0,255,65,.03), transparent 70%);
    }

    .drop-zone:hover, .drop-zone.drag-over {
        border-color: var(--green);
        background: var(--bg3);
        box-shadow: 0 0 20px rgba(0,255,65,.1), inset 0 0 30px rgba(0,255,65,.03);
    }

    .drop-icon {
        font-size: 48px;
        display: block;
        margin-bottom: 16px;
        filter: drop-shadow(0 0 8px var(--green));
    }

    .drop-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 16px;
        color: var(--green);
        letter-spacing: 2px;
        margin-bottom: 8px;
    }

    .drop-sub {
        color: var(--text-dim);
        font-size: 12px;
        letter-spacing: 1px;
    }

    #fileInput { display: none; }

    .btn-load {
        display: inline-block;
        margin-top: 20px;
        padding: 10px 28px;
        background: transparent;
        border: 1px solid var(--green);
        color: var(--green);
        font-family: 'Orbitron', sans-serif;
        font-size: 12px;
        letter-spacing: 2px;
        cursor: pointer;
        border-radius: 4px;
        transition: all .2s;
    }
    .btn-load:hover {
        background: var(--green);
        color: var(--bg);
        box-shadow: 0 0 16px rgba(0,255,65,.4);
    }

    /* ‚îÄ‚îÄ META KARTA ‚îÄ‚îÄ */
    .meta-card {
        display: none;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin-top: 28px;
    }

    .meta-item {
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 14px 16px;
        transition: border-color .2s;
    }
    .meta-item:hover { border-color: var(--green-dim); }

    .meta-label {
        font-size: 10px;
        letter-spacing: 2px;
        color: var(--text-dim);
        text-transform: uppercase;
        margin-bottom: 6px;
    }

    .meta-value {
        font-family: 'Orbitron', sans-serif;
        font-size: 14px;
        color: var(--green);
        word-break: break-all;
    }

    /* ‚îÄ‚îÄ Z√ÅLO≈ΩKY ‚îÄ‚îÄ */
    .tabs {
        display: none;
        gap: 4px;
        margin-top: 28px;
        flex-wrap: wrap;
    }

    .tab {
        padding: 8px 18px;
        background: var(--bg2);
        border: 1px solid var(--border);
        border-bottom: none;
        color: var(--text-dim);
        font-family: 'Orbitron', sans-serif;
        font-size: 11px;
        letter-spacing: 1px;
        cursor: pointer;
        border-radius: 4px 4px 0 0;
        transition: all .2s;
        position: relative;
    }

    .tab:hover { color: var(--green); border-color: var(--green-dim); }

    .tab.active {
        background: var(--bg3);
        color: var(--green);
        border-color: var(--green);
        box-shadow: 0 0 10px rgba(0,255,65,.15);
    }

    .tab .badge {
        display: inline-block;
        margin-left: 6px;
        background: var(--green-dim);
        color: var(--bg);
        border-radius: 10px;
        padding: 1px 6px;
        font-size: 9px;
        font-family: 'Share Tech Mono', monospace;
    }

    .tab.active .badge { background: var(--green); }

    /* ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ */
    .panel {
        display: none;
        background: var(--bg2);
        border: 1px solid var(--green);
        border-radius: 0 6px 6px 6px;
        padding: 0;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0,255,65,.05);
    }
    .panel.active { display: block; }

    /* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
    .panel-toolbar {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        background: var(--bg3);
        border-bottom: 1px solid var(--border);
        flex-wrap: wrap;
    }

    .search-input {
        flex: 1;
        min-width: 180px;
        background: var(--bg);
        border: 1px solid var(--border);
        color: var(--green);
        font-family: 'Share Tech Mono', monospace;
        font-size: 13px;
        padding: 7px 12px;
        border-radius: 4px;
        outline: none;
        transition: border-color .2s;
    }
    .search-input::placeholder { color: var(--text-dim); }
    .search-input:focus { border-color: var(--green); }

    .count-badge {
        font-size: 11px;
        color: var(--text-dim);
        white-space: nowrap;
    }
    .count-badge span { color: var(--green); }

    /* ‚îÄ‚îÄ TABULKA ‚îÄ‚îÄ */
    .table-wrap {
        max-height: 480px;
        overflow-y: auto;
    }

    .table-wrap::-webkit-scrollbar { width: 6px; }
    .table-wrap::-webkit-scrollbar-track { background: var(--bg); }
    .table-wrap::-webkit-scrollbar-thumb { background: var(--green-dim); border-radius: 3px; }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }

    thead th {
        position: sticky;
        top: 0;
        background: var(--bg3);
        color: var(--text-dim);
        font-size: 10px;
        letter-spacing: 2px;
        text-transform: uppercase;
        padding: 10px 14px;
        text-align: left;
        border-bottom: 1px solid var(--border);
        z-index: 1;
    }

    tbody tr {
        border-bottom: 1px solid rgba(26,58,26,.5);
        transition: background .15s;
        cursor: pointer;
    }
    tbody tr:hover { background: rgba(0,255,65,.03); }

    td {
        padding: 9px 14px;
        vertical-align: top;
    }

    .td-key {
        color: var(--blue);
        font-weight: bold;
        white-space: nowrap;
        max-width: 240px;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .td-val {
        color: var(--text);
        max-width: 500px;
        word-break: break-all;
        font-size: 12px;
        line-height: 1.5;
    }

    .td-size {
        color: var(--text-dim);
        white-space: nowrap;
        font-size: 11px;
        text-align: right;
    }

    /* ‚îÄ‚îÄ EXPANDED ROW ‚îÄ‚îÄ */
    .expanded-row td {
        background: var(--bg3);
        padding: 0;
    }

    .expanded-content {
        padding: 12px 16px;
        border-top: 1px solid var(--border);
    }

    .expanded-content pre {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 12px;
        font-size: 12px;
        color: var(--green);
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-all;
        max-height: 300px;
        overflow-y: auto;
        line-height: 1.6;
    }

    /* ‚îÄ‚îÄ COOKIES PANEL ‚îÄ‚îÄ */
    .cookies-box {
        padding: 16px;
        font-size: 12px;
        color: var(--text);
        line-height: 1.8;
        word-break: break-all;
        font-family: 'Share Tech Mono', monospace;
    }

    .empty-state {
        padding: 40px;
        text-align: center;
        color: var(--text-dim);
        font-size: 13px;
        letter-spacing: 1px;
    }

    /* ‚îÄ‚îÄ STATUS BAR ‚îÄ‚îÄ */
    .status-bar {
        display: none;
        align-items: center;
        gap: 8px;
        margin-top: 16px;
        padding: 10px 16px;
        background: var(--bg2);
        border: 1px solid var(--border);
        border-radius: 4px;
        font-size: 12px;
        color: var(--text-dim);
    }

    .status-dot {
        width: 8px; height: 8px;
        border-radius: 50%;
        background: var(--green);
        box-shadow: 0 0 6px var(--green);
        animation: pulse 2s infinite;
        flex-shrink: 0;
    }

    @keyframes pulse {
        0%,100% { opacity: 1; }
        50% { opacity: .3; }
    }

    /* ‚îÄ‚îÄ HIGHLIGHT ‚îÄ‚îÄ */
    mark {
        background: rgba(0,255,65,.25);
        color: var(--green);
        border-radius: 2px;
        padding: 0 2px;
    }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 600px) {
        .logo { font-size: 20px; letter-spacing: 2px; }
        .td-val { max-width: 200px; }
        .td-key { max-width: 120px; }
    }
</style>
</head>
<body>
<div class="wrapper">

    <!-- HEADER -->
    <header>
        <div class="logo">‚ò¢Ô∏è ATOMOVKA BACKUP VIEWER</div>
        <div class="subtitle">LEHK√Å ATOMOVKA V3 ¬∑ Z√ÅLOHOVAC√ç SYST√âM ¬∑ STAR TREK HUDEBN√ç P≈òEHRAVAƒå</div>
    </header>

    <hr class="divider">

    <!-- DROP ZONE -->
    <div class="drop-zone" id="dropZone">
        <span class="drop-icon">üì¶</span>
        <div class="drop-title">NAƒåTI Z√ÅLOHU</div>
        <div class="drop-sub">P≈ôet√°hni soubor <strong>atomovka-backup-*.json</strong> sem</div>
        <div class="drop-sub" style="margin-top:6px">nebo</div>
        <button class="btn-load" onclick="document.getElementById('fileInput').click()">
            üìÇ VYBRAT SOUBOR
        </button>
        <input type="file" id="fileInput" accept=".json">
    </div>

    <!-- META INFO -->
    <div class="meta-card" id="metaCard">
        <div class="meta-item">
            <div class="meta-label">üìÖ Datum z√°lohy</div>
            <div class="meta-value" id="metaTimestamp">‚Äî</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">‚öôÔ∏è Verze atomovky</div>
            <div class="meta-value" id="metaVersion">‚Äî</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">üóÑÔ∏è localStorage polo≈æky</div>
            <div class="meta-value" id="metaLocalCount">‚Äî</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">üíæ sessionStorage polo≈æky</div>
            <div class="meta-value" id="metaSessionCount">‚Äî</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">üìÅ Soubor</div>
            <div class="meta-value" id="metaFileName">‚Äî</div>
        </div>
    </div>

    <!-- STATUS BAR -->
    <div class="status-bar" id="statusBar">
        <div class="status-dot"></div>
        <span id="statusText">Z√°loha naƒçtena.</span>
    </div>

    <!-- Z√ÅLO≈ΩKY -->
    <div class="tabs" id="tabs">
        <div class="tab active" data-tab="local">
            üíæ localStorage <span class="badge" id="badgeLocal">0</span>
        </div>
        <div class="tab" data-tab="session">
            üîÑ sessionStorage <span class="badge" id="badgeSession">0</span>
        </div>
        <div class="tab" data-tab="cookies">
            üç™ Cookies
        </div>
    </div>

    <!-- PANEL: localStorage -->
    <div class="panel active" id="panel-local">
        <div class="panel-toolbar">
            <input class="search-input" type="text" placeholder="üîç Hledat kl√≠ƒç nebo hodnotu..." id="searchLocal">
            <span class="count-badge">Zobrazeno: <span id="countLocal">0</span></span>
        </div>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th style="width:240px">KL√çƒå</th>
                        <th>HODNOTA</th>
                        <th style="width:80px;text-align:right">VELIKOST</th>
                    </tr>
                </thead>
                <tbody id="bodyLocal"></tbody>
            </table>
        </div>
    </div>

    <!-- PANEL: sessionStorage -->
    <div class="panel" id="panel-session">
        <div class="panel-toolbar">
            <input class="search-input" type="text" placeholder="üîç Hledat kl√≠ƒç nebo hodnotu..." id="searchSession">
            <span class="count-badge">Zobrazeno: <span id="countSession">0</span></span>
        </div>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th style="width:240px">KL√çƒå</th>
                        <th>HODNOTA</th>
                        <th style="width:80px;text-align:right">VELIKOST</th>
                    </tr>
                </thead>
                <tbody id="bodySession"></tbody>
            </table>
        </div>
    </div>

    <!-- PANEL: Cookies -->
    <div class="panel" id="panel-cookies">
        <div class="cookies-box" id="cookiesContent">
            <span style="color:var(--text-dim)">≈Ω√°dn√© cookies v z√°loze.</span>
        </div>
    </div>

</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ò¢Ô∏è ATOMOVKA BACKUP VIEWER - LOGIKA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let backupData = null;
let expandedRow = null;

// ‚îÄ‚îÄ FILE INPUT ‚îÄ‚îÄ
document.getElementById('fileInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) loadFile(file);
});

// ‚îÄ‚îÄ DRAG & DROP ‚îÄ‚îÄ
const dropZone = document.getElementById('dropZone');

dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));

dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file) loadFile(file);
});

// ‚îÄ‚îÄ NAƒåTEN√ç SOUBORU ‚îÄ‚îÄ
function loadFile(file) {
    if (!file.name.endsWith('.json')) {
        showStatus('‚ùå Soubor mus√≠ b√Ωt .json!', true);
        return;
    }

    const reader = new FileReader();
    reader.onload = e => {
        try {
            const parsed = JSON.parse(e.target.result);
            processBackup(parsed, file.name);
        } catch (err) {
            showStatus('‚ùå Neplatn√Ω JSON soubor: ' + err.message, true);
        }
    };
    reader.readAsText(file);
}

// ‚îÄ‚îÄ ZPRACOV√ÅN√ç Z√ÅLOHY ‚îÄ‚îÄ
function processBackup(data, fileName) {
    backupData = data;

    // META
    const ts = data.timestamp ? new Date(data.timestamp) : null;
    document.getElementById('metaTimestamp').textContent =
        ts ? ts.toLocaleString('cs-CZ') : '‚Äî';
    document.getElementById('metaVersion').textContent =
        data.version || '‚Äî';
    document.getElementById('metaLocalCount').textContent =
        Object.keys(data.data?.localStorage || {}).length;
    document.getElementById('metaSessionCount').textContent =
        Object.keys(data.data?.sessionStorage || {}).length;
    document.getElementById('metaFileName').textContent = fileName;

    // BADGES
    document.getElementById('badgeLocal').textContent =
        Object.keys(data.data?.localStorage || {}).length;
    document.getElementById('badgeSession').textContent =
        Object.keys(data.data?.sessionStorage || {}).length;

    // Zobrazit UI
    document.getElementById('metaCard').style.display = 'grid';
    document.getElementById('tabs').style.display     = 'flex';
    document.getElementById('statusBar').style.display = 'flex';

    // Render
    renderTable('local', data.data?.localStorage || {});
    renderTable('session', data.data?.sessionStorage || {});
    renderCookies(data.data?.cookies || '');

    showStatus(`‚úÖ Z√°loha naƒçtena ‚Äî ${fileName}`);
}

// ‚îÄ‚îÄ RENDER TABULKY ‚îÄ‚îÄ
function renderTable(type, dataObj, filter = '') {
    const tbody = document.getElementById('body' + cap(type));
    const countEl = document.getElementById('count' + cap(type));
    tbody.innerHTML = '';

    const entries = Object.entries(dataObj).filter(([k, v]) => {
        if (!filter) return true;
        const f = filter.toLowerCase();
        return k.toLowerCase().includes(f) || String(v).toLowerCase().includes(f);
    });

    countEl.textContent = entries.length;

    if (entries.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3"><div class="empty-state">‚ò¢Ô∏è ≈Ω√°dn√© polo≈æky</div></td></tr>`;
        return;
    }

    entries.forEach(([key, value]) => {
        const size = formatBytes((key.length + String(value).length) * 2);
        const preview = truncate(String(value), 120);

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="td-key" title="${esc(key)}">${highlight(esc(key), filter)}</td>
            <td class="td-val">${highlight(esc(preview), filter)}</td>
            <td class="td-size">${size}</td>
        `;

        tr.addEventListener('click', () => toggleExpand(tr, key, value, type));
        tbody.appendChild(tr);
    });
}

// ‚îÄ‚îÄ EXPAND ROW ‚îÄ‚îÄ
function toggleExpand(tr, key, value, type) {
    // Zav≈ô√≠t p≈ôedchoz√≠
    if (expandedRow) {
        expandedRow.remove();
        expandedRow = null;
        if (tr.classList.contains('was-expanded')) {
            tr.classList.remove('was-expanded');
            return;
        }
    }
    tr.classList.add('was-expanded');

    let prettyVal = value;
    try { prettyVal = JSON.stringify(JSON.parse(value), null, 2); } catch(e) {}

    const expTr = document.createElement('tr');
    expTr.className = 'expanded-row';
    expTr.innerHTML = `
        <td colspan="3">
            <div class="expanded-content">
                <div style="font-size:11px;color:var(--text-dim);letter-spacing:1px;margin-bottom:8px">
                    üîë KL√çƒå: <span style="color:var(--blue)">${esc(key)}</span>
                </div>
                <pre>${esc(prettyVal)}</pre>
            </div>
        </td>
    `;

    tr.after(expTr);
    expandedRow = expTr;
}

// ‚îÄ‚îÄ COOKIES ‚îÄ‚îÄ
function renderCookies(cookieStr) {
    const box = document.getElementById('cookiesContent');
    if (!cookieStr || cookieStr.trim() === '') {
        box.innerHTML = '<span style="color:var(--text-dim)">≈Ω√°dn√© cookies v z√°loze.</span>';
        return;
    }

    const cookies = cookieStr.split(';').filter(c => c.trim());
    if (cookies.length === 0) {
        box.innerHTML = '<span style="color:var(--text-dim)">≈Ω√°dn√© cookies.</span>';
        return;
    }

    box.innerHTML = cookies.map(c => {
        const [name, ...rest] = c.trim().split('=');
        return `<div style="margin-bottom:6px">
            <span style="color:var(--blue)">${esc(name.trim())}</span>
            <span style="color:var(--text-dim)"> = </span>
            <span style="color:var(--text)">${esc(rest.join('='))}</span>
        </div>`;
    }).join('');
}

// ‚îÄ‚îÄ Z√ÅLO≈ΩKY ‚îÄ‚îÄ
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('panel-' + tab.dataset.tab).classList.add('active');
        expandedRow = null;
    });
});

// ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ
document.getElementById('searchLocal').addEventListener('input', e => {
    if (backupData) renderTable('local', backupData.data?.localStorage || {}, e.target.value);
});
document.getElementById('searchSession').addEventListener('input', e => {
    if (backupData) renderTable('session', backupData.data?.sessionStorage || {}, e.target.value);
});

// ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ
function showStatus(msg, isError = false) {
    const bar = document.getElementById('statusBar');
    const txt = document.getElementById('statusText');
    const dot = bar.querySelector('.status-dot');
    bar.style.display = 'flex';
    txt.textContent = msg;
    dot.style.background = isError ? 'var(--error)' : 'var(--green)';
    dot.style.boxShadow   = isError ? '0 0 6px var(--error)' : '0 0 6px var(--green)';
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
function cap(s)      { return s.charAt(0).toUpperCase() + s.slice(1); }
function esc(s)      { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function truncate(s,n){ return s.length > n ? s.substring(0,n) + '‚Ä¶' : s; }
function formatBytes(b){
    if (b < 1024) return b + ' B';
    if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
    return (b/1048576).toFixed(2) + ' MB';
}
function highlight(text, query) {
    if (!query) return text;
    const safe = query.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    return text.replace(new RegExp(`(${safe})`, 'gi'), '<mark>$1</mark>');
}
</script>
</body>
</html>
